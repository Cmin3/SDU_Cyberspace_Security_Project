# 基于DCT的数字水印系统实现

## 一、项目概述

本项目实现了一个基于DCT变换的数字水印系统，能够在图像中嵌入和提取二进制水印信息。系统采用扩频技术增强鲁棒性，并测试了多种常见图像处理操作对水印提取的影响。该系统可用于版权保护、内容认证等应用场景。

## 二、算法原理详解

### 1. 水印嵌入原理

1. **预处理**：
   - 将图像转换为YCrCb色彩空间，仅使用亮度(Y)通道
   - 将图像分割为8×8的块

2. **DCT变换**：
   - 对每个8×8块进行离散余弦变换(DCT)

3. **水印嵌入**：
   - 在中频系数(3,4)位置嵌入水印信息
   - 使用伪随机序列(PRN)进行扩频
   - 嵌入公式：`d[u,v] += α * prn[index] * (bit==1 ? 1 : -1)`

4. **IDCT变换**：
   - 对修改后的DCT系数进行逆变换

### 2. 水印提取原理

1. **同步处理**：
   - 与嵌入过程相同的分块和DCT变换

2. **相关性检测**：
   - 计算每个块中频系数与对应PRN的相关性
   - 根据相关性正负判断比特值

3. **多数表决**：
   - 每个比特由多个块共同表示
   - 通过统计相关性结果确定最终比特值

## 三、文件说明

### 主要代码文件(code/)

- `watermark.py`：主程序文件，包含：
  - `embed_watermark()`：水印嵌入函数
  - `extract_watermark()`：水印提取函数
  - 多种攻击测试函数

### 测试结果文件(result/)

- `result.png`：终端输出结果截图

### 水印图像(watermark/)
  
- `watermarked.png`：含水印的图像
- `attacked_*.png`：各种攻击后的图像：
  - `flip_h/v`：水平/垂直翻转
  - `translate`：平移
  - `crop`：裁剪
  - `contrast_low/high`：对比度调整

## 四、运行结果

测试使用32位随机水印信息，结果如下：

| 攻击类型 | 比特准确率 | 样例图像 |
|----------|------------|----------|
| 原始水印 | 1.000 | watermarked.png |
| 水平翻转 | 0.375 | attacked_flip_h.png |
| 垂直翻转 | 0.500 | attacked_flip_v.png |
| 平移 | 0.531 | attacked_translate.png |
| 裁剪 | 0.938 | attacked_crop.png |
| 低对比度 | 1.000 | attacked_contrast_low.png |
| 高对比度 | 1.000 | attacked_contrast_high.png |

## 五、构建与运行

### 环境准备

```bash
pip install numpy opencv-python pillow
```

### 使用示例

1. 准备测试图像`sample.png`
2. 运行测试脚本：
```bash
python watermark.py
```

### 主要参数调整

- `alpha`：水印强度(默认5.0)
- `seed`：伪随机序列种子(默认123)
- `message_bits`：水印信息(二进制数组)

## 六、实现特点

1. **鲁棒性**：
   - 使用扩频技术增强抗攻击能力
   - 中频系数嵌入平衡了不可见性和鲁棒性

2. **灵活性**：
   - 支持自定义水印强度和长度
   - 易于扩展新的攻击测试

3. **可视化**：
   - 自动保存各种攻击后的图像
   - 提供比特准确率量化评估

4. **实用性**：
   - 基于OpenCV/PIL实现，易于集成
   - 支持常见图像格式

